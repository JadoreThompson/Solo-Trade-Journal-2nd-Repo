<!DOCTYPE html>
<html>
  <head>

    <title>Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">

    <style>
      body {
        font-family: 'Montserrat', sans-serif;
        background-color: #f1f1f1;
      }


      .main-container {
        display: flex;
        flex-direction: column;
        width:100%;
        height: 100vh;
      }


      .first-row {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        width: 100%;
        height: 50px;
        background-color: white;
        margin-bottom: 10px;
      }

      .second-row {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        width: 100%;
        height: 400px;
        background-color: white;
        margin-bottom: 10px;
      }

      .second-row-card {
        margin-right: 10px;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        transition: 0.3s;
        border-radius: 5px;
      }

      .second-row-card:last-child {
        margin-right: 0;
        width:20%;
      }

      .second-row-card:first-child {
        width: 80%;
      }

      .card {
        margin-right: 10px;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        transition: 0.3s;
        width: 40%;
        border-radius: 5px;
      }

      .card:last-child {
        margin-right: 0;
      }

      .card:hover {
        box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
      }

      .container {
        margin-left: 10px;
      }

      h4, span {
        margin: 0;
        padding: 0;
      }

      span {
        font-size: 10px;
        color: #9e9e9e;
      }



      .chart-card {
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        transition: 0.3s;
        border-radius: 5px;
        overflow: hidden;
      }

      .card-body {
        display: flex;
        flex-direction: row;

        height: 100%;
      }

      .card-body div {
        margin-right: 20px;
      }

      #container {
        height: 100%;
        width: 100%;
      }

      .stat-card {
        background-color: white;
      }

      .stat-card .card-body{
        justify-content: space-between;
        margin-left: 7px;
      }

      .third-row{
        width: 100%;
        height: 300px;
      }

      .third-row-card{
        width: 100%;
        background-color: white;
        height: 100%
      }

      .card-body table{
        width: 100%;
      }

      td {
        text-align: center;
      }

      tr th{
        border-bottom: #9e9e9e 1px solid;
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <div class="first-row">
        <div class="card">
          <div class="container">
            <span>7d Pnl</span>
            <h4>{{weekly_profit }}%</h4>
          </div>
        </div>

        <div class="card">
          <div class="container">
            <span>Balance</span>
            <h4>${{ account_balance }}</h4>
          </div>
        </div>

        <div class="card">
          <div class="container">
            <span>Total Profit</span>
            <h4>{{ total_profit }}</h4>
          </div>
        </div>
      </div>

      <div class="second-row">

        <div class="chart-card second-row-card">
            <div id="container"
              style="width: 100%; height: 100%; margin: 0;
              padding: 0;">
            </div>
            <script>
              const chartOptions = { layout: { textColor: 'black', background: { type: 'solid', color: 'white' } } };
              const chart = LightweightCharts.createChart(document.getElementById('container'), chartOptions);
              const lineSeries = chart.addLineSeries({ color: '#2962FF' });

              // Convert the monthly_list from Python to JavaScript
              const monthlyData = JSON.parse('{{ monthly_list | tojson | safe }}');

              // Process the data for the chart
              const chartData = monthlyData.map(item => {
                // Convert the Unix timestamp to a JavaScript Date object
                const date = new Date(item.date * 1000);
                // Format the date as 'Month Year' (e.g., 'January 2022')
                const formattedDate = date.toLocaleString('default', { month: 'long' }) + ' ' + date.getFullYear();

                return {
                  time: formattedDate,
                  value: item.growth
                };
              });

              lineSeries.setData(chartData);

              chart.timeScale().fitContent();
            </script>
        </div>

        <div class="stat-card second-row-card">
          <div class="container">
            <div class="card-title">
              <h4>Statistics</h4>
            </div>
            <div class="card-body">
              <div class="stat-label">
                <span>Balance</span>
                <span>Broker</span>
              </div>
              <div class="stat-value">
                <span>${{ account_size }}</span>
                  <span></span>

              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="third-row">
        <div class="third-row-card">
          <div class="container">
            <div class="card-title">
              <span>HistoryTable</span>
              <!-- <h4>100%</h4> -->
            </div>
            <div class="card-body">
              <table>
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Symbol</th>
                        <th>Lots</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody>
                    {% for trade in trades_list %}
                        <tr>
                        <td>{{ trade.open_time }}</td>
                        <td>{{ trade.symbol }}</td>
                        <td>{{ trade.lots }}</td>
                        <td>{{ trade.type }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html> 
      
